#!/bin/bash

##############################################################################
# 패키지 설치 및 환경 설정 스크립트
# 우분투 22.04 기준
##############################################################################

# 색상 설정
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

##############################################################################
# 1. 업데이트 및 업그레이드
##############################################################################
echo -e "${GREEN}[INFO] 시스템 패키지 목록 업데이트 중...${NC}"
sudo apt update -y
if [[ $? -ne 0 ]]; then
    echo -e "${RED}[ERROR] 패키지 목록 업데이트에 실패했습니다.${NC}"
    exit 1
fi

echo -e "${GREEN}[INFO] 시스템 패키지 업그레이드 중...${NC}"
sudo apt upgrade -y
if [[ $? -ne 0 ]]; then
    echo -e "${RED}[ERROR] 패키지 업그레이드에 실패했습니다.${NC}"
    exit 1
fi

##############################################################################
# 2. 필수 패키지 설치
##############################################################################
echo -e "${GREEN}[INFO] 필수 패키지 설치 중...${NC}"
sudo apt install -y \
    build-essential \
    sysstat \
    dstat \
    fio \
    sysbench \
    python3 \
    python3-pip

if [[ $? -ne 0 ]]; then
    echo -e "${RED}[ERROR] 필수 패키지 설치에 실패했습니다.${NC}"
    exit 1
fi

##############################################################################
# 3. sysstat 설정 변경 (데이터 수집 활성화)
##############################################################################
echo -e "${GREEN}[INFO] sysstat 데이터 수집 활성화 설정 중...${NC}"
sudo sed -i 's/ENABLED="false"/ENABLED="true"/' /etc/default/sysstat

if [[ $? -ne 0 ]]; then
    echo -e "${RED}[ERROR] sysstat 설정 변경에 실패했습니다.${NC}"
    exit 1
fi

echo -e "${GREEN}[INFO] sysstat 서비스 재시작 중...${NC}"
sudo systemctl restart sysstat
if [[ $? -ne 0 ]]; then
    echo -e "${RED}[ERROR] sysstat 서비스 재시작에 실패했습니다.${NC}"
    exit 1
fi

##############################################################################
# 4. Python 패키지 설치
##############################################################################
echo -e "${GREEN}[INFO] Python 패키지 설치 중...${NC}"
pip3 install --upgrade pip
pip3 install pandas matplotlib seaborn

if [[ $? -ne 0 ]]; then
    echo -e "${RED}[ERROR] Python 패키지 설치에 실패했습니다.${NC}"
    exit 1
fi

##############################################################################
# 5. 설치 완료 메시지
##############################################################################
echo -e "${BLUE}[INFO] 모든 패키지 설치 및 설정이 완료되었습니다.${NC}"
echo -e "${BLUE}[INFO] 이제 벤치마크 스크립트를 실행할 준비가 되었습니다.${NC}"